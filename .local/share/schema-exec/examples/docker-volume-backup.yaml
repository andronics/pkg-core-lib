# Example: Docker Volume Backup
# This schema demonstrates backing up Docker volumes with proper dependency ordering

schema: "action/v1"
version: "1.0.0"

metadata:
  name: "docker-volume-backup"
  description: "Backup critical Docker volumes with dependency ordering"
  author: "andronics"
  tags:
    - docker
    - backup
    - volumes

# Context variables (available in gomplate templates)
context:
  backup_date: "{{ now | date \"2006-01-02\" }}"
  backup_base: "~/.local/share/docker-backups"

# Actions to execute (in dependency order)
actions:
  # Backup postgres data volume
  - id: "backup_postgres_data"
    type: "docker.volume"
    resource: "postgres_data"
    action: "backup"
    params:
      backup_file: "{{ .backup_base }}/postgres_data_{{ .backup_date }}.tar.gz"
      compression: "gzip"
    store_result_as: "postgres_backup_file"

  # Backup redis data volume
  - id: "backup_redis_data"
    type: "docker.volume"
    resource: "redis_data"
    action: "backup"
    params:
      backup_file: "{{ .backup_base }}/redis_data_{{ .backup_date }}.tar.gz"
      compression: "gzip"
    store_result_as: "redis_backup_file"

  # Backup nginx config volume
  - id: "backup_nginx_config"
    type: "docker.volume"
    resource: "nginx_config"
    action: "backup"
    params:
      backup_file: "{{ .backup_base }}/nginx_config_{{ .backup_date }}.tar.gz"
      compression: "gzip"
    store_result_as: "nginx_backup_file"

# Global configuration
config:
  on_failure: "stop"  # Stop on first failure

# Rollback actions (executed in reverse order if schema fails)
rollback:
  enabled: false
  actions: []
